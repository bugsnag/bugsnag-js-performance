version: '3.6'

services:

  license-finder:
    build:
      dockerfile: dockerfiles/Dockerfile.license-finder
      context: .
    volumes:
      - .:/scan

  browser-maze-runner: &browser-maze-runner
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.browser-feature-builder
      args:
        MAZE_RUNNER_VERSION: v7.26.1-cli
    environment: &browser-maze-runner-environment
      BUILDKITE:
      BUILDKITE_BRANCH:
      BUILDKITE_BUILD_CREATOR:
      BUILDKITE_BUILD_NUMBER:
      BUILDKITE_BUILD_URL:
      BUILDKITE_LABEL:
      BUILDKITE_MESSAGE:
      BUILDKITE_PIPELINE_NAME:
      BUILDKITE_REPO:
      BUILDKITE_RETRY_COUNT:
      BUILDKITE_STEP_KEY:
      MAZE_BUGSNAG_API_KEY:
      MAZE_ASPECTO_REPEATER_API_KEY:
      MAZE_REPEATER_API_KEY:
      MAZE_TMS_URI:
      MAZE_TMS_TOKEN:
      DEBUG:
      BROWSER_STACK_USERNAME:
      BROWSER_STACK_ACCESS_KEY:
      BROWSER_STACK_BROWSERS_USERNAME:
      BROWSER_STACK_BROWSERS_ACCESS_KEY:
      BROWSER_STACK_DEVICES_USERNAME:
      BROWSER_STACK_DEVICES_ACCESS_KEY:
      HOST: "${HOST:-maze-runner}"
      API_HOST: "${API_HOST:-maze-runner}"
    env_file:
      - ${DOCKER_ENV_FILE:-test/browser/features/fixtures/null_env}
    networks:
      default:
        aliases:
          - maze-runner
    volumes:
      - ./test/browser/maze_output:/app/test/browser/maze_output

  browser-maze-runner-legacy:
    <<: *browser-maze-runner
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.browser-feature-builder
      args:
        MAZE_RUNNER_VERSION: v7.26.1-cli-legacy
    environment:
      <<: *browser-maze-runner-environment
      USE_LEGACY_DRIVER: 1
