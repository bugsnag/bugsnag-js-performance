# CI test image for unit/lint/type tests
FROM node:18-alpine as browser-feature-builder

RUN apk add --update curl-dev git make gcc g++ musl-dev ruby-full ruby-dev

WORKDIR /app

COPY . .
RUN npm install

# Install packages
WORKDIR /app/test/browser

RUN SKIP_FIXTURE_CLEANUP=true ruby ./features/support/build-packages.rb

RUN bundle install

# Don't rebuild packages during e2e tests
ENV SKIP_BUILD_PACKAGES=true

ENTRYPOINT ["bundle", "exec", "maze-runner"]
